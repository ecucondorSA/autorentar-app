#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Pre-commit checks..."

# Regenerate types if database.types.ts changed
if git diff --cached --name-only | grep -q "database.types.ts"; then
  echo "âš ï¸  database.types.ts changed - regenerating..."
  pnpm types:gen
  git add src/types/database.types.ts
fi

# Lint and fix (only staged TypeScript files)
echo "ğŸ”§ Running ESLint..."
pnpm eslint src --ext .ts,.tsx --fix --quiet || {
  echo "âŒ Linting failed"
  exit 1
}
git add -A

# Type check
echo "ğŸ” Type checking..."
pnpm typecheck || {
  echo "âŒ Type check failed"
  exit 1
}

# Check for banned patterns
if grep -rn "as never" src --include="*.ts" | grep -v "database.types.ts"; then
  echo "âŒ Found 'as never' - use proper types"
  exit 1
fi

echo "âœ… Pre-commit checks passed"
